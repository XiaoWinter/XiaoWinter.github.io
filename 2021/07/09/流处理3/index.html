<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"xiaowinter.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Blob ArrayBuffer 和视图（view）都是 ECMA 标准的一部分，是 JavaScript 的一部分。 在浏览器中，还有其他更高级的对象，特别是 Blob，在 File API 中有相关描述。 Blob 由一个可选的字符串 type（通常是 MIME 类型）和 blobParts 组成 —— 一系列其他 Blob 对象，字符串和 BufferSource。">
<meta property="og:type" content="article">
<meta property="og:title" content="【浏览器怎么操作二进制】【三】Blob 消费者">
<meta property="og:url" content="https://xiaowinter.github.io/2021/07/09/%E6%B5%81%E5%A4%84%E7%90%863/index.html">
<meta property="og:site_name" content="DaWinter">
<meta property="og:description" content="Blob ArrayBuffer 和视图（view）都是 ECMA 标准的一部分，是 JavaScript 的一部分。 在浏览器中，还有其他更高级的对象，特别是 Blob，在 File API 中有相关描述。 Blob 由一个可选的字符串 type（通常是 MIME 类型）和 blobParts 组成 —— 一系列其他 Blob 对象，字符串和 BufferSource。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zh.javascript.info/article/blob/blob.svg">
<meta property="article:published_time" content="2021-07-09T11:54:00.000Z">
<meta property="article:modified_time" content="2021-07-09T11:54:00.000Z">
<meta property="article:author" content="Da Winter">
<meta property="article:tag" content="Blob">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zh.javascript.info/article/blob/blob.svg">


<link rel="canonical" href="https://xiaowinter.github.io/2021/07/09/%E6%B5%81%E5%A4%84%E7%90%863/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://xiaowinter.github.io/2021/07/09/%E6%B5%81%E5%A4%84%E7%90%863/","path":"2021/07/09/流处理3/","title":"【浏览器怎么操作二进制】【三】Blob 消费者"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>【浏览器怎么操作二进制】【三】Blob 消费者 | DaWinter</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">DaWinter</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">DaWinter's blob</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#blob"><span class="nav-number">1.</span> <span class="nav-text">Blob</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#blob-%E6%8E%A5%E5%8F%A3%E5%8F%82%E8%80%83"><span class="nav-number">1.1.</span> <span class="nav-text">Blob
接口参考</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#blob-%E7%94%A8%E4%BD%9C-url"><span class="nav-number">1.2.</span> <span class="nav-text">Blob 用作
URL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#blob-%E8%BD%AC%E6%8D%A2%E4%B8%BA-base64"><span class="nav-number">1.3.</span> <span class="nav-text">Blob
转换为 base64</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#image-%E8%BD%AC%E6%8D%A2%E4%B8%BA-blob"><span class="nav-number">1.4.</span> <span class="nav-text">Image
转换为 blob</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#blob-%E8%BD%AC%E6%8D%A2%E4%B8%BA-arraybuffer"><span class="nav-number">1.5.</span> <span class="nav-text">Blob
转换为 ArrayBuffer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">1.6.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Da Winter"
      src="https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/Desig萨达ner.png">
  <p class="site-author-name" itemprop="name">Da Winter</p>
  <div class="site-description" itemprop="description">开发经历</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">38</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://xiaowinter.github.io/2021/07/09/%E6%B5%81%E5%A4%84%E7%90%863/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://typora-huang-cong.oss-cn-shanghai.aliyuncs.com/Desig萨达ner.png">
      <meta itemprop="name" content="Da Winter">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DaWinter">
      <meta itemprop="description" content="开发经历">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="【浏览器怎么操作二进制】【三】Blob 消费者 | DaWinter">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          【浏览器怎么操作二进制】【三】Blob 消费者
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-09 19:54:00" itemprop="dateCreated datePublished" datetime="2021-07-09T19:54:00+08:00">2021-07-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JS%E4%BA%8C%E8%BF%9B%E5%88%B6/" itemprop="url" rel="index"><span itemprop="name">JS二进制</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h3 id="blob">Blob</h3>
<p><code>ArrayBuffer</code> 和视图（view）都是 ECMA 标准的一部分，是
JavaScript 的一部分。</p>
<p>在浏览器中，还有其他更<span
style="color:red">高级的对象</span>，特别是 <code>Blob</code>，在 <a
target="_blank" rel="noopener" href="https://www.w3.org/TR/FileAPI/">File API</a> 中有相关描述。</p>
<p><code>Blob</code> 由一个可选的字符串 <code>type</code>（通常是 MIME
类型）和 <code>blobParts</code> 组成 —— 一系列其他 <code>Blob</code>
对象，字符串和 <code>BufferSource</code>。</p>
<p><img data-src="https://zh.javascript.info/article/blob/blob.svg"></p>
<span id="more"></span>
<p>构造函数的语法为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Blob</span>(blobParts, options);</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong><code>blobParts</code></strong> 是
<code>Blob</code>/<code>BufferSource</code>/<code>String</code>
类型的值的数组。</p></li>
<li><p><code>options</code></p>
<p>可选对象：</p>
<ul>
<li><strong><code>type</code></strong> —— <code>Blob</code> 类型，通常是
MIME 类型，例如 <code>image/png</code>，</li>
<li><strong><code>endings</code></strong> —— 是否转换换行符，使
<code>Blob</code> 对应于当前操作系统的换行符（<code>\r\n</code> 或
<code>\n</code>）。默认为
<code>"transparent"</code>（啥也不做），不过也可以是
<code>"native"</code>（转换）。</li>
</ul></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从字符串创建 Blob</span></span><br><span class="line"><span class="keyword">let</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([<span class="string">&quot;&lt;html&gt;…&lt;/html&gt;&quot;</span>], &#123; <span class="attr">type</span>: <span class="string">&quot;text/html&quot;</span> &#125;);</span><br><span class="line"><span class="comment">// 请注意：第一个参数必须是一个数组 [...]</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从类型化数组（typed array）和字符串创建 Blob</span></span><br><span class="line"><span class="keyword">let</span> hello = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>([<span class="number">72</span>, <span class="number">101</span>, <span class="number">108</span>, <span class="number">108</span>, <span class="number">111</span>]); <span class="comment">// 二进制格式的 &quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([hello, <span class="string">&quot; &quot;</span>, <span class="string">&quot;world&quot;</span>], &#123; <span class="attr">type</span>: <span class="string">&quot;text/plain&quot;</span> &#125;);</span><br></pre></td></tr></table></figure>
<p>我们可以用 <code>slice</code> 方法来提取 <code>Blob</code> 片段：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blob.<span class="title function_">slice</span>([byteStart], [byteEnd], [contentType]);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>byteStart</code></strong> —— 起始字节，默认为 0。</li>
<li><strong><code>byteEnd</code></strong> ——
最后一个字节（专有，默认为最后）。</li>
<li><strong><code>contentType</code></strong> —— 新 blob 的
<code>type</code>，默认与源 blob 相同。</li>
</ul>
<p>参数值类似于 <code>array.slice</code>，也允许是负数。</p>
<p><strong><code>Blob</code> 对象是不可改变的</strong></p>
<p>我们无法直接在 <code>Blob</code> 中更改数据，但我们可以通过
<code>slice</code> 获得 <code>Blob</code> 的多个部分，从这些部分创建新的
<code>Blob</code> 对象，将它们组成新的 <code>Blob</code>，等。</p>
<p>这种行为类似于 JavaScript
字符串：我们无法更改字符串中的字符，但可以生成一个新的改动过的字符串。</p>
<h4 id="blob-接口参考"><a
target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob">Blob
接口参考</a></h4>
<table>
<colgroup>
<col style="width: 4%" />
<col style="width: 87%" />
<col style="width: 8%" />
</colgroup>
<thead>
<tr class="header">
<th>属性</th>
<th></th>
<th>读写性</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>size</td>
<td><code>Blob</code> 对象中所包含数据的大小（字节）。</td>
<td>readonly</td>
</tr>
<tr class="even">
<td>type</td>
<td>一个字符串，表明该 <code>Blob</code> 对象所包含数据的 MIME
类型。如果类型未知，则该值为空字符串。</td>
<td>readonly</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 38%" />
<col style="width: 58%" />
<col style="width: 2%" />
</colgroup>
<thead>
<tr class="header">
<th>方法</th>
<th>return</th>
<th>返回类型</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a
target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob/slice"><code>Blob.slice([start[, end[, contentType\]]])</code></a></td>
<td>返回一个新的 <code>Blob</code> 对象，包含了源 <code>Blob</code>
对象中指定范围内的数据。</td>
<td>blob</td>
</tr>
<tr class="even">
<td><a
target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob/stream"><code>Blob.stream()</code></a></td>
<td>返回一个能读取 blob 内容的 <a
target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/ReadableStream"><code>ReadableStream</code></a>。<a
target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/98848420">知乎详解</a></td>
<td></td>
</tr>
<tr class="odd">
<td><a
target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob/text"><code>Blob.text()</code></a></td>
<td>返回一个 promise 且包含 blob 所有内容的 UTF-8 格式的 <a
target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/USVString"><code>USVString</code></a>。</td>
<td>Promise</td>
</tr>
<tr class="even">
<td><a
target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob/arrayBuffer"><code>Blob.arrayBuffer()</code></a></td>
<td>返回一个 promise 且包含 blob 所有内容的二进制格式的 <a
target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code>ArrayBuffer</code></a></td>
<td>Promise</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="blob-用作-url"><a
target="_blank" rel="noopener" href="https://zh.javascript.info/blob#blob-yong-zuo-url">Blob 用作
URL</a></h4>
<p><span style="color:red">Blob 可以很容易用作
<code>&lt;a&gt;</code>、<code>&lt;img&gt;</code> 或其他标签的
URL，来显示它们的内容。</span></p>
<p>多亏了 <code>type</code>，让我们也可以下载/上传 <code>Blob</code>
对象，而在网络请求中，<code>type</code> 自然地变成了
<code>Content-Type</code>。</p>
<p>让我们从一个简单的例子开始。通过点击链接，你可以下载一个具有动态生成的内容为
<code>hello world</code> 的 <code>Blob</code> 的文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- download 特性（attribute）强制浏览器下载而不是导航 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">download</span>=<span class="string">&quot;hello.txt&quot;</span> <span class="attr">href</span>=<span class="string">&#x27;#&#x27;</span> <span class="attr">id</span>=<span class="string">&quot;link&quot;</span>&gt;</span>Download<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([<span class="string">&quot;Hello, world!&quot;</span>], &#123;<span class="attr">type</span>: <span class="string">&#x27;text/plain&#x27;</span>&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">link.<span class="property">href</span> = <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(blob);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p><code>URL.createObjectURL</code> 取一个
<code>Blob</code>，并为其创建一个唯一的 URL，形式为
<code>blob:&lt;origin&gt;/&lt;uuid&gt;</code>。</p>
<p>也就是 <code>link.href</code> 的值的样子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blob:https://javascript.info/1e67e00e-860d-40a5-89ae-6ab0cbee6273</span><br></pre></td></tr></table></figure>
<p>浏览器内部为每个通过 <code>URL.createObjectURL</code> 生成的 URL
存储了一个 URL → <code>Blob</code> 映射。因此，此类 URL 很短，但可以访问
<code>Blob</code>。</p>
<p>生成的 URL（即其链接）仅在当前文档打开的状态下才有效。它允许引用
<code>&lt;img&gt;</code>、<code>&lt;a&gt;</code> 中的
<code>Blob</code>，以及基本上任何其他期望 URL 的对象。</p>
<p>不过它有个副作用。虽然这里有 <code>Blob</code> 的映射，但
<code>Blob</code> 本身只保存在内存中的。浏览器无法释放它。</p>
<p>在文档退出时（unload），该映射会被自动清除，因此 <code>Blob</code>
也相应被释放了。但是，如果应用程序寿命很长，那这个释放就不会很快发生。</p>
<p><strong>因此，如果我们创建一个 URL，那么即使我们不再需要该
<code>Blob</code> 了，它也会被挂在内存中。</strong></p>
<p><code>URL.revokeObjectURL(url)</code> 从内部映射中移除引用，因此允许
<code>Blob</code> 被删除（如果没有其他引用的话），并释放内存。</p>
<p>在上面最后一个示例中，我们打算仅使用一次
<code>Blob</code>，来进行即时下载，因此我们立即调用
<code>URL.revokeObjectURL(link.href)</code>。</p>
<p>而在前一个带有可点击的 HTML 链接的示例中，我们不调用
<code>URL.revokeObjectURL(link.href)</code>，因为那样会使
<code>Blob</code> URL 无效。在调用该方法后，由于映射被删除了，因此该 URL
也就不再起作用了。</p>
<h4 id="blob-转换为-base64"><a
target="_blank" rel="noopener" href="https://zh.javascript.info/blob#blob-zhuan-huan-wei-base64">Blob
转换为 base64</a></h4>
<p><code>URL.createObjectURL</code> 的一个替代方法是，将
<code>Blob</code> 转换为 base64-编码的字符串。</p>
<p>这种编码将二进制数据表示为一个由 0 到 64 的 ASCII
码组成的字符串，非常安全且“可读“。更重要的是 —— 我们可以在 “data-url”
中使用此编码。</p>
<p><a
target="_blank" rel="noopener" href="https://developer.mozilla.org/zh/docs/Web/http/Data_URIs">“data-url”</a>
的形式为
<code>data:[&lt;mediatype&gt;][;base64],&lt;data&gt;</code>。我们可以在任何地方使用这种
url，和使用“常规” url 一样。</p>
<p>例如，这是一个笑脸：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;data:image/png;base64,R0lGODlhDAAMAKIFAF5LAP/zxAAAANyuAP/gaP///wAAAAAAACH5BAEAAAUALAAAAAAMAAwAAAMlWLPcGjDKFYi9lxKBOaGcF35DhWHamZUW0K4mAbiwWtuf0uxFAgA7&quot;</span>&gt;</span><br></pre></td></tr></table></figure>
<p>浏览器将解码该字符串，并显示图像：<img data-src="data:image/png;base64,R0lGODlhDAAMAKIFAF5LAP/zxAAAANyuAP/gaP///wAAAAAAACH5BAEAAAUALAAAAAAMAAwAAAMlWLPcGjDKFYi9lxKBOaGcF35DhWHamZUW0K4mAbiwWtuf0uxFAgA7"></p>
<p>我们使用内建的 <code>FileReader</code> 对象来将 <code>Blob</code>
转换为 base64。它可以将 <code>Blob</code> 中的数据读取为多种格式。在<a
target="_blank" rel="noopener" href="https://zh.javascript.info/file">下一章</a>
我们将更深入地介绍它。</p>
<p>下面是下载 <code>Blob</code> 的示例，这次是通过 base-64：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> link = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">link.<span class="property">download</span> = <span class="string">&quot;hello.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([<span class="string">&quot;Hello, world!&quot;</span>], &#123; <span class="attr">type</span>: <span class="string">&quot;text/plain&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line">reader.<span class="title function_">readAsDataURL</span>(blob); <span class="comment">// 将 Blob 转换为 base64 并调用 onload</span></span><br><span class="line"></span><br><span class="line">reader.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  link.<span class="property">href</span> = reader.<span class="property">result</span>; <span class="comment">// data url</span></span><br><span class="line">  link.<span class="title function_">click</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这两种从 <code>Blob</code> 创建 URL 的方法都可以用。但通常
<code>URL.createObjectURL(blob)</code> 更简单快捷。</p>
<table>
<colgroup>
<col style="width: 46%" />
<col style="width: 53%" />
</colgroup>
<thead>
<tr class="header">
<th>URL.createObjectURL(blob)</th>
<th><strong>Blob 转换为 data url</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>如果介意内存，我们需要撤销（revoke）它们</td>
<td>无需撤销（revoke）任何操作。</td>
</tr>
<tr class="even">
<td>直接访问 <code>Blob</code>，无需“编码/解码”</td>
<td>对大的 <code>Blob</code> 进行编码时，性能和内存会有损耗。</td>
</tr>
</tbody>
</table>
<h4 id="image-转换为-blob"><a
target="_blank" rel="noopener" href="https://zh.javascript.info/blob#image-zhuan-huan-wei-blob">Image
转换为 blob</a></h4>
<p>我们可以创建一个图像（image）的、图像的一部分、或者甚至创建一个页面截图的
<code>Blob</code>。这样方便将其上传至其他地方</p>
<p>图像操作是通过 <code>&lt;canvas&gt;</code> 元素来实现的：</p>
<ol type="1">
<li>使用 <a
target="_blank" rel="noopener" href="https://developer.mozilla.org/zh/docs/Web/api/CanvasRenderingContext2D/drawImage">canvas.drawImage</a>
在 canvas 上绘制图像（或图像的一部分）。</li>
<li>调用 canvas 方法 <a
target="_blank" rel="noopener" href="https://developer.mozilla.org/zh/docs/Web/api/HTMLCanvasElement/toBlob">.toBlob(callback,
format, quality)</a> 创建一个
<code>Blob</code>，并在创建完成后使用其运行 <code>callback</code>。</li>
</ol>
<p>在下面这个示例中，图像只是被复制了，不过我们可以在创建 blob
之前，从中裁剪图像，或者在 canvas 上对其进行转换：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取任何图像</span></span><br><span class="line"><span class="keyword">let</span> img = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;img&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成同尺寸的 &lt;canvas&gt;</span></span><br><span class="line"><span class="keyword">let</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line">canvas.<span class="property">width</span> = img.<span class="property">clientWidth</span>;</span><br><span class="line">canvas.<span class="property">height</span> = img.<span class="property">clientHeight</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> context = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向其中复制图像（此方法允许剪裁图像）</span></span><br><span class="line">context.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// 我们 context.rotate()，并在 canvas 上做很多其他事情</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// toBlob 是异步操作，结束后会调用 callback</span></span><br><span class="line">canvas.<span class="title function_">toBlob</span>(<span class="keyword">function</span> (<span class="params">blob</span>) &#123;</span><br><span class="line">  <span class="comment">// blob 创建完成，下载它</span></span><br><span class="line">  <span class="keyword">let</span> link = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">  link.<span class="property">download</span> = <span class="string">&quot;example.png&quot;</span>;</span><br><span class="line"></span><br><span class="line">  link.<span class="property">href</span> = <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(blob);</span><br><span class="line">  link.<span class="title function_">click</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除内部 blob 引用，这样浏览器可以从内存中将其清除</span></span><br><span class="line">  <span class="variable constant_">URL</span>.<span class="title function_">revokeObjectURL</span>(link.<span class="property">href</span>);</span><br><span class="line">&#125;, <span class="string">&quot;image/png&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>如果我们更喜欢 <code>async/await</code> 而不是 callback：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> blob = <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span></span><br><span class="line">  canvasElem.<span class="title function_">toBlob</span>(resolve, <span class="string">&quot;image/png&quot;</span>),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>对于页面截屏，我们可以使用诸如
https://github.com/niklasvh/html2canvas
之类的库。它所做的只是扫一遍浏览器页面，并将其绘制在
<code>&lt;canvas&gt;</code> 上。然后，我们就可以像上面一样获取一个它的
<code>Blob</code>。</p>
<h4 id="blob-转换为-arraybuffer"><a
target="_blank" rel="noopener" href="https://zh.javascript.info/blob#blob-zhuan-huan-wei-arraybuffer">Blob
转换为 ArrayBuffer</a></h4>
<p><code>Blob</code> 构造器允许从几乎所有东西创建 blob，包括任何
<code>BufferSource</code>。</p>
<p>但是，如果我们需要执行低级别的操作的话，则可以使用
<code>FileReader</code> 从 blob 中获取最低级别的
<code>ArrayBuffer</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从 blob 获取 arrayBuffer</span></span><br><span class="line"><span class="keyword">let</span> fileReader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line"></span><br><span class="line">fileReader.<span class="title function_">readAsArrayBuffer</span>(blob);</span><br><span class="line"></span><br><span class="line">fileReader.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> arrayBuffer = fileReader.<span class="property">result</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="总结">总结</h4>
<p><code>ArrayBuffer</code>，<code>Uint8Array</code> 及其他
<code>BufferSource</code> 是“二进制数据”，而 <a
target="_blank" rel="noopener" href="https://www.w3.org/TR/FileAPI/#dfn-Blob">Blob</a>
则表示“具有类型的二进制数据”（ <code>Blob</code> 类型，通常是 MIME
类型，例如 <code>image/png</code>，）。</p>
<p>这样可以方便 <code>Blob</code>
用于在浏览器中非常常见的上传/下载操作。</p>
<p><a
target="_blank" rel="noopener" href="https://zh.javascript.info/xmlhttprequest">XMLHttpRequest</a>，<a
target="_blank" rel="noopener" href="https://zh.javascript.info/fetch">fetch</a> 等进行 Web
请求的方法可以自然地使用
<code>Blob</code>，也可以使用其他类型的二进制数据。</p>
<p>我们可以轻松地在 <code>Blob</code>
和低级别的二进制数据类型之间进行转换：</p>
<ul>
<li>我们可以使用 <code>new Blob(...)</code>
构造函数从一个类型化数组（typed array）创建 <code>Blob</code>。</li>
<li>我们可以使用 <code>FileReader</code> 从 <code>Blob</code> 中取回
<code>ArrayBuffer</code>，然后在其上创建一个视图（view），用于低级别的二进制处理。</li>
</ul>
<p>参考</p>
<p><a
target="_blank" rel="noopener" href="https://github.com/XiaoWinter/browser_binary_usage.git">【服务器】二进制处理功能源码</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/98848420">从 Fetch 到 Streams
—— 以流的角度处理网络请求</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob">MDN
Blob</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Blob/" rel="tag"># Blob</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/07/09/%E6%B5%81%E5%A4%84%E7%90%864/" rel="prev" title="【浏览器怎么操作二进制】【四】文件File及文件读取FileReader">
                  <i class="fa fa-angle-left"></i> 【浏览器怎么操作二进制】【四】文件File及文件读取FileReader
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/07/09/%E6%B5%81%E5%A4%84%E7%90%862/" rel="next" title="【浏览器怎么操作二进制】【二】文本的二进制数据编解码">
                  【浏览器怎么操作二进制】【二】文本的二进制数据编解码 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Da Winter</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
